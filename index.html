<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LifeSim Expanded</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
    button { margin: 5px; padding: 10px; font-size: 16px; }
    #log { margin-top: 15px; max-height: 200px; overflow-y: auto; }
    .event { background: #fff; padding: 8px; margin-bottom: 5px; border-radius: 4px; }
    .popup {
      display: none;
      position: fixed;
      top: 25%;
      left: 25%;
      width: 50%;
      background: #fffbea;
      border: 2px solid #888;
      padding: 20px;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0,0,0,0.25);
      border-radius: 6px;
    }
    .popup button { margin: 5px; }
    #overlay {
      display: none;
      position: fixed; 
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      z-index: 900;
    }
  </style>
</head>
<body>

  <h1>🧬 LifeSim Expanded</h1>
  <div id="info">
    <p><strong>Name:</strong> <span id="name">-</span></p>
    <p><strong>Age:</strong> <span id="age">0</span></p>
    <div>
      ❤️ Health: <span id="health">100</span><br>
      😀 Happiness: <span id="happiness">100</span><br>
      🧠 Smarts: <span id="smarts">100</span><br>
      😎 Looks: <span id="looks">100</span><br>
      💵 Money: $<span id="money">0</span>
    </div>
  </div>

  <button onclick="newLife()">👶 Start New Life</button>
  <button onclick="ageUp()">📆 Age Up</button>
  <button onclick="openOptions()">⚙️ Options</button>

  <div id="log"></div>

  <!-- Popup & Overlay -->
  <div id="overlay"></div>

  <div id="popup" class="popup">
    <p id="popupText"></p>
    <div id="popupChoices"></div>
    <button onclick="closePopup()">Close</button>
  </div>

  <script>
    let player = {};
    let relationships = [];
    let hasPassedDriversTest = false;
    let jobApplied = false;

    // Generate random name helper
    function randomName() {
      const firstNames = ["Jeremy", "Alex", "Jordan", "Taylor", "Chris", "Morgan", "Sam", "Casey", "Blake", "Reese"];
      const lastNames = ["Hinn", "Cole", "Smith", "Brown", "Lee", "Garcia", "Johnson", "Clark", "White", "Hall"];
      return firstNames[Math.floor(Math.random() * firstNames.length)] + " " +
             lastNames[Math.floor(Math.random() * lastNames.length)];
    }

    // Generate a list of varied events
    function getRandomEvent() {
      const events = [];

      // Friend request events only up to age 8
      if (player.age <= 8) {
        let friendName = randomName();
        events.push({
          text: `A kid named ${friendName} wants to be your friend.`,
          choices: [
            {
              text: "Be friends",
              effect: () => {
                // Check if already friend
                if (!relationships.some(r => r.name === friendName && r.relation === "Friend")) {
                  relationships.push({ name: friendName, relation: "Friend", age: player.age, closeness: 80 });
                  logEvent(`👫 You became friends with ${friendName}!`);
                } else {
                  logEvent(`👫 You are already friends with ${friendName}.`);
                }
              }
            },
            {
              text: "Say nah",
              effect: () => logEvent(`😐 You ignored ${friendName}.`)
            }
          ]
        });
      }

      // Other random events
      events.push(
        {
          text: "You found $10 on the ground.",
          choices: [
            {
              text: "Take it",
              effect: () => {
                player.money += 10;
                logEvent("💸 You picked up $10.");
                updateDisplay();
              }
            },
            {
              text: "Turn it in",
              effect: () => {
                player.happiness += 5;
                logEvent("😇 You turned it in. (+5 Happiness)");
                updateDisplay();
              }
            }
          ]
        },
        {
          text: "You got food poisoning from school lunch.",
          choices: [
            {
              text: "Rest and recover",
              effect: () => {
                player.health -= 15;
                logEvent("🤢 You felt sick. (-15 Health)");
                updateDisplay();
              }
            }
          ]
        },
        {
          text: "Your dad took you fishing.",
          choices: [
            {
              text: "Enjoy the time",
              effect: () => {
                player.happiness += 10;
                logEvent("🎣 You had fun with your dad. (+10 Happiness)");
                updateDisplay();
              }
            }
          ]
        },
        {
          text: "You studied hard and aced a test!",
          choices: [
            {
              text: "Celebrate",
              effect: () => {
                player.smarts += 15;
                player.happiness += 5;
                logEvent("📚 Smarts +15, Happiness +5");
                updateDisplay();
              }
            }
          ]
        },
        {
          text: "You helped an elderly neighbor.",
          choices: [
            {
              text: "Feel good about it",
              effect: () => {
                player.happiness += 10;
                logEvent("🙂 Happiness +10");
                updateDisplay();
              }
            }
          ]
        },
        {
          text: "You got bullied at school.",
          choices: [
            {
              text: "Stay strong",
              effect: () => {
                player.happiness -= 10;
                logEvent("😞 Happiness -10");
                updateDisplay();
              }
            }
          ]
        }
      );

      // Pick one random event from this list
      return events[Math.floor(Math.random() * events.length)];
    }

    // Start new life
    function newLife() {
      player = {
        name: prompt("Enter your name:"),
        age: 0,
        health: 100,
        happiness: 100,
        smarts: 100,
        looks: 100,
        money: 0,
        isAlive: true
      };
      relationships = [
        { name: randomName(), relation: "Mother", age: 30, closeness: 100 },
        { name: randomName(), relation: "Father", age: 32, closeness: 100 }
      ];
      hasPassedDriversTest = false;
      jobApplied = false;
      updateDisplay();
      logEvent(`🎉 A new life begins for ${player.name}!`);
    }

    // Age up one year and trigger event
    function ageUp() {
      if (!player.isAlive) return;
      player.age++;
      relationships.forEach(r => r.age++);
      document.getElementById("age").textContent = player.age;

      // Check if dead
      if (player.health <= 0) {
        player.isAlive = false;
        showDeath();
        return;
      }

      // Aging effects (health slowly drops after 70)
      if (player.age > 70) {
        player.health -= 5;
      }

      // Show a random event
      const event = getRandomEvent();
      showPopup(event.text, event.choices);

      updateDisplay();
    }

    // Update UI stats display
    function updateDisplay() {
      document.getElementById("name").textContent = player.name || "-";
      document.getElementById("age").textContent = player.age || 0;
      document.getElementById("health").textContent = Math.max(0, player.health);
      document.getElementById("happiness").textContent = Math.min(100, Math.max(0, player.happiness));
      document.getElementById("smarts").textContent = Math.min(150, Math.max(0, player.smarts));
      document.getElementById("looks").textContent = Math.min(150, Math.max(0, player.looks));
      document.getElementById("money").textContent = player.money;
    }

    // Logging event to screen
    function logEvent(text) {
      const div = document.createElement("div");
      div.className = "event";
      div.textContent = text;
      document.getElementById("log").prepend(div);
    }

    // Popup show/hide
    function showPopup(text, choices) {
      const popup = document.getElementById("popup");
      const popupText = document.getElementById("popupText");
      const popupChoices = document.getElementById("popupChoices");
      const overlay = document.getElementById("overlay");

      popupText.textContent = text;
      popupChoices.innerHTML = "";

      choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.textContent = choice.text;
        btn.onclick = () => {
          choice.effect();
          closePopup();
        };
        popupChoices.appendChild(btn);
      });

      popup.style.display = "block";
      overlay.style.display = "block";
    }
    function closePopup() {
      document.getElementById("popup").style.display = "none";
      document.getElementById("overlay").style.display = "none";
    }

    // Options menu with multiple actions
    function openOptions() {
      const options = [
        {
          text: "View Relationships",
          effect: () => {
            closePopup();
            showRelationships();
          }
        },
        {
          text: "Driver’s Test",
          effect: () => {
            closePopup();
            driversTest();
          }
        },
        {
          text: "Apply for Job",
          effect: () => {
            closePopup();
            applyJob();
          }
        },
        {
          text: "Commit Crime",
          effect: () => {
            closePopup();
            commitCrime();
          }
        }
      ];
      showPopup("Options Menu: Choose an action", options);
    }

    // Show relationships popup
    function showRelationships() {
      const relText = relationships.length === 0
        ? "You have no relationships yet."
        : relationships.map(r => `${r.relation} - ${r.name} (Age: ${r.age}) Relationship: ${r.closeness}/100`).join("\n");
      alert("Your Relationships:\n\n" + relText);
    }

    // Driver’s Test logic
    function driversTest() {
      if (player.age < 16) {
        alert("You must be at least 16 to take the driver’s test.");
        return;
      }
      if (hasPassedDriversTest) {
        alert("You have already passed your driver’s test.");
        return;
      }
      // 50% chance pass
      if (Math.random() < 0.5) {
        hasPassedDriversTest = true;
        alert("🎉 You passed the driver’s test! You can now drive.");
        logEvent("🚗 Passed driver’s test.");
      } else {
        alert("🚫 You failed the driver’s test. Try again next year.");
        logEvent("Failed driver’s test.");
      }
    }

    // Job application logic
    function applyJob() {
      if (player.age < 14) {
        alert("You must be at least 14 to apply for a job.");
        return;
      }
      if (jobApplied) {
        alert("You already have a job.");
        return;
      }

      const jobs = [
        { name: "Cashier", salary: 10000, chance: 0.9 },
        { name: "Waiter/Waitress", salary: 25000, chance: 0.6 },
        { name: "Police Officer", salary: 50000, chance: 0.35 }
      ];

      let jobOptions = jobs.map(j => ({
        text: `${j.name} ($${j.salary}/year)`,
        effect: () => {
          if (Math.random() < j.chance) {
            jobApplied = true;
            player.money += j.salary; // Start with first year pay for simplicity
            alert(`You got the job as a ${j.name}!`);
            logEvent(`💼 Hired as ${j.name} earning $${j.salary}/year.`);
            updateDisplay();
          } else {
            alert(`You did not get the ${j.name} job.`);
            logEvent(`Job application failed for ${j.name}.`);
          }
        }
      }));

      showPopup("Choose a job to apply for:", jobOptions);
    }

    // Crime committing logic
    function commitCrime() {
      if (player.age < 18) {
        alert("You must be at least 18 to commit crimes.");
        return;
      }

      const crimes = [
        {
          text: "Rob a bank",
          effect: () => {
            const bank = randomName();
            if (Math.random() < 0.5) {
              let loot = 50000 + Math.floor(Math.random() * 100000);
              player.money += loot;
              alert(`You successfully robbed the ${bank} bank and stole $${loot}!`);
              logEvent(`💰 Robbed ${bank} bank for $${loot}.`);
              updateDisplay();
            } else {
              alert(`You were caught robbing the ${bank} bank and jailed.`);
              logEvent(`🚓 Caught robbing ${bank} bank. Sent to jail.`);
              player.health -= 30;
              updateDisplay();
              if (player.health <= 0) showDeath();
            }
          }
        },
        {
          text: "Murder someone",
          effect: () => {
            const victim = randomName();
            if (Math.random() < 0.5) {
              alert(`You successfully murdered ${victim}.`);
              logEvent(`🔪 Murdered ${victim}.`);
              player.money += 100000;
              updateDisplay();
            } else {
              alert(`You were caught for murdering ${victim} and jailed.`);
              logEvent(`🚓 Caught for murdering ${victim}. Sent to jail.`);
              player.health -= 40;
              updateDisplay();
              if (player.health <= 0) showDeath();
            }
          }
        }
      ];

      showPopup("Choose a crime to commit:", crimes);
    }

    // Show death popup and life summary
    function showDeath() {
      const summary = 
        `💀 RIP ${player.name}\n` +
        `Age: ${player.age}\n` +
        `Health: ${Math.max(0, player.health)}\n` +
        `Happiness: ${Math.min(100, Math.max(0, player.happiness))}\n` +
        `Smarts: ${Math.min(150, Math.max(0, player.smarts))}\n` +
        `Looks: ${Math.min(150, Math.max(0, player.looks))}\n` +
        `Money: $${player.money}\n\n` +
        "Start a new life to play again.";

      alert(summary);
      logEvent(`🕯️ ${player.name} died at age ${player.age}.`);
    }
  </script>

</body>
</html>
