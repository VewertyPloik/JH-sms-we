<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Music Grid Game</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    user-select: none;
  }
  #note-selection {
    display: flex;
    flex-wrap: wrap;
    max-width: 520px;
    margin-bottom: 10px;
  }
  .note-button {
    width: 30px;
    height: 30px;
    margin: 3px;
    border-radius: 5px;
    cursor: pointer;
    border: 2px solid transparent;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    color: black;
    font-weight: bold;
  }
  .note-button.selected {
    border-color: #2ecc71;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(8, 50px);
    grid-template-rows: repeat(8, 50px);
    gap: 5px;
    margin-bottom: 20px;
  }
  .cell {
    background: #222;
    border-radius: 6px;
    border: 1px solid #444;
    position: relative;
    cursor: pointer;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .cell:hover {
    background: #333;
  }
  .note-in-cell {
    width: 30px;
    height: 30px;
    border-radius: 6px;
    transition: transform 0.2s ease, filter 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #111;
    font-weight: bold;
    user-select: none;
  }
  .playing {
    filter: brightness(1.7);
    transform: scale(1.5);
    z-index: 10;
    box-shadow: 0 0 10px #fff;
  }
  #controls {
    margin-bottom: 10px;
  }
  button {
    background: #2ecc71;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    color: #111;
    font-weight: bold;
    cursor: pointer;
    margin: 0 5px;
    transition: background-color 0.3s;
  }
  button:hover {
    background: #27ae60;
  }
  #selected-note-name {
    margin-top: 5px;
    font-size: 18px;
    height: 24px;
  }
  .line {
    position: absolute;
    top: -5px;
    bottom: -5px;
    width: 5px;
    background: #e74c3c;
    border-radius: 3px;
    pointer-events: none;
    transition: left 0.1s linear;
    z-index: 20;
  }
  #grid-container {
    position: relative;
  }
</style>
</head>
<body>

<h1>Music Grid</h1>

<div id="note-selection"></div>
<div id="selected-note-name">Select a note</div>

<div id="grid-container">
  <div id="grid"></div>
  <div id="play-line" class="line" style="display:none;"></div>
</div>

<div id="controls">
  <button id="play-btn">Play</button>
  <button id="stop-btn" disabled>Stop</button>
</div>

<script>
  // Notes data - 20 notes with colors, names and frequencies (C4 - G6 range)
  const notes = [
    { name: "C4", freq: 261.63, color: "#e74c3c" },
    { name: "D4", freq: 293.66, color: "#e67e22" },
    { name: "E4", freq: 329.63, color: "#f1c40f" },
    { name: "F4", freq: 349.23, color: "#2ecc71" },
    { name: "G4", freq: 392.00, color: "#1abc9c" },
    { name: "A4", freq: 440.00, color: "#3498db" },
    { name: "B4", freq: 493.88, color: "#9b59b6" },
    { name: "C5", freq: 523.25, color: "#34495e" },
    { name: "D5", freq: 587.33, color: "#c0392b" },
    { name: "E5", freq: 659.25, color: "#d35400" },
    { name: "F5", freq: 698.46, color: "#f39c12" },
    { name: "G5", freq: 783.99, color: "#27ae60" },
    { name: "A5", freq: 880.00, color: "#16a085" },
    { name: "B5", freq: 987.77, color: "#2980b9" },
    { name: "C6", freq: 1046.50, color: "#8e44ad" },
    { name: "D6", freq: 1174.66, color: "#2c3e50" },
    { name: "E6", freq: 1318.51, color: "#c0392b" },
    { name: "F6", freq: 1396.91, color: "#d35400" },
    { name: "G6", freq: 1567.98, color: "#f39c12" },
    { name: "A6", freq: 1760.00, color: "#27ae60" },
  ];

  const gridSize = 8;
  const grid = document.getElementById("grid");
  const noteSelection = document.getElementById("note-selection");
  const selectedNoteName = document.getElementById("selected-note-name");
  const playBtn = document.getElementById("play-btn");
  const stopBtn = document.getElementById("stop-btn");
  const playLine = document.getElementById("play-line");
  const cellSize = 50 + 5; // cell size + gap for calculation

  let selectedNoteIndex = null;
  let cells = [];
  let gridNotes = Array(gridSize * gridSize).fill(null); // store note index or null
  let audioCtx = null;
  let isPlaying = false;
  let playPosition = 0;
  let playInterval = null;

  // Create note selection buttons
  notes.forEach((note, i) => {
    const btn = document.createElement("div");
    btn.classList.add("note-button");
    btn.style.backgroundColor = note.color;
    btn.title = note.name;
    btn.textContent = note.name;
    btn.addEventListener("click", () => {
      selectedNoteIndex = i;
      updateSelectedNoteUI();
    });
    noteSelection.appendChild(btn);
  });

  function updateSelectedNoteUI() {
    [...noteSelection.children].forEach((btn, i) => {
      btn.classList.toggle("selected", i === selectedNoteIndex);
    });
    if (selectedNoteIndex === null) {
      selectedNoteName.textContent = "Select a note";
    } else {
      selectedNoteName.textContent = `Selected: ${notes[selectedNoteIndex].name}`;
    }
  }

  // Create grid cells
  for (let i = 0; i < gridSize * gridSize; i++) {
    const cell = document.createElement("div");
    cell.classList.add("cell");
    cell.dataset.index = i;

    // create a note placeholder
    const noteDiv = document.createElement("div");
    noteDiv.classList.add("note-in-cell");
    cell.appendChild(noteDiv);

    cell.addEventListener("click", () => {
      if (selectedNoteIndex === null) return;
      // place note or remove note if same note clicked
      if (gridNotes[i] === selectedNoteIndex) {
        gridNotes[i] = null;
        noteDiv.style.backgroundColor = "";
        noteDiv.textContent = "";
      } else {
        gridNotes[i] = selectedNoteIndex;
        const note = notes[selectedNoteIndex];
        noteDiv.style.backgroundColor = note.color;
        noteDiv.textContent = note.name;
      }
    });

    grid.appendChild(cell);
    cells.push(cell);
  }

  function playNote(freq, duration = 0.3) {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();

    osc.frequency.value = freq;
    osc.type = "sine";
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    osc.start();
    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
    osc.stop(audioCtx.currentTime + duration);
  }

  function highlightCell(i) {
    const cell = cells[i];
    if (!cell) return;
    const noteDiv = cell.querySelector(".note-in-cell");
    noteDiv.classList.add("playing");
  }
  function unhighlightCell(i) {
    const cell = cells[i];
    if (!cell) return;
    const noteDiv = cell.querySelector(".note-in-cell");
    noteDiv.classList.remove("playing");
  }

  function playStep(pos) {
    if (pos > 0) {
      unhighlightCell(pos - 1);
    } else if (pos === 0) {
      unhighlightCell(gridSize - 1);
    }
    if (pos >= gridSize) return;

    // Move play line
    playLine.style.left = (pos * (50 + 5)) + "px";

    // Highlight notes in this column and play sounds
    for (let row = 0; row < gridSize; row++) {
      let cellIndex = row * gridSize + pos;
      let noteIdx = gridNotes[cellIndex];
      if (noteIdx !== null) {
        highlightCell(cellIndex);
        playNote(notes[noteIdx].freq);
      }
    }
  }

  function startPlaying() {
    if (isPlaying) return;
    isPlaying = true;
    playPosition = 0;
    playLine.style.display = "block";
    playLine.style.left = "0px";

    playStep(playPosition);

    playInterval = setInterval(() => {
      playPosition++;
      if (playPosition >= gridSize) {
        // Loop back to start
        unhighlightCell(playPosition - 1);
        playPosition = 0;
      }
      playStep(playPosition);
    }, 600);
    playBtn.disabled = true;
    stopBtn.disabled = false;
  }

  function stopPlaying() {
    if (!isPlaying) return;
    isPlaying = false;
    clearInterval(playInterval);
    playInterval = null;
    playLine.style.display = "none";
    // Remove highlight from all
    cells.forEach((cell, i) => {
      unhighlightCell(i);
    });
    playBtn.disabled = false;
    stopBtn.disabled = true;
  }

  playBtn.addEventListener("click", startPlaying);
  stopBtn.addEventListener("click", stopPlaying);

  updateSelectedNoteUI();

</script>

</body>
</html>
